<!DOCTYPE html>
    <html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>hyperxmail - Relatórios</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <style>
            :root {
                --bg-gradient-start: #101727;
                --bg-gradient-end: #2c3e50;
                --text-primary: #ecf0f1;
                --accent-primary: #3498db;
                --container-bg: rgba(255, 255, 255, 0.08);
                --container-border: rgba(255, 255, 255, 0.2);
                --font-family: 'Poppins', sans-serif;
            }
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body {
                font-family: var(--font-family);
                background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
                color: var(--text-primary);
                padding: 20px;
            }
            .container {
                background: var(--container-bg);
                backdrop-filter: blur(10px);
                border: 1px solid var(--container-border);
                border-radius: 16px;
                padding: 40px;
                width: 95%;
                max-width: 1200px;
                margin: auto;
                box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            }
            h1 {
                text-align: center;
                margin-bottom: 30px;
            }
            #campaigns-list {
                margin-bottom: 30px;
            }
            #campaigns-list select {
                width: 100%;
                padding: 15px;
                background: rgba(0,0,0,0.2);
                border: 1px solid var(--accent-primary);
                border-radius: 8px;
                color: var(--text-primary);
                font-size: 16px;
            }
            #report-details {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 30px;
            }
            .stat-card {
                background: rgba(0,0,0,0.2);
                padding: 20px;
                border-radius: 8px;
                text-align: center;
            }
            .stat-card h3 {
                margin-bottom: 10px;
                color: var(--accent-primary);
            }
            .stat-card p {
                font-size: 24px;
                font-weight: 600;
            }
            #chart-container {
                grid-column: span 2;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>Relatórios de Campanhas</h1>
            <div id="campaigns-list">
                <select id="campaign-select" onchange="loadReport()">
                    <option value="">Selecione uma campanha</option>
                </select>
            </div>
            <div id="report-details" style="display: none;">
                <div class="stat-card">
                    <h3>Total Enviado</h3>
                    <p id="total-sent"></p>
                </div>
                <div class="stat-card">
                    <h3>Aberturas Únicas</h3>
                    <p id="unique-opens"></p>
                </div>
                <div class="stat-card">
                    <h3>Cliques Únicos</h3>
                    <p id="unique-clicks"></p>
                </div>
                 <div class="stat-card">
                    <h3>Taxa de Abertura</h3>
                    <p id="open-rate"></p>
                </div>
                <div id="chart-container">
                    <canvas id="report-chart"></canvas>
                </div>
            </div>
        </div>

        <script>
            let reportChart;

            async function loadCampaigns() {
                const response = await fetch('/api/campaigns');
                const campaigns = await response.json();
                const select = document.getElementById('campaign-select');
                campaigns.forEach(c => {
                    const option = document.createElement('option');
                    option.value = c.id;
                    option.textContent = `${c.subject} (${c.created_at})`;
                    select.appendChild(option);
                });
            }

            async function loadReport() {
                const campaignId = document.getElementById('campaign-select').value;
                if (!campaignId) {
                    document.getElementById('report-details').style.display = 'none';
                    return;
                }

                const response = await fetch(`/api/reports/${campaignId}`);
                const report = await response.json();

                document.getElementById('total-sent').textContent = report.total_sent;
                document.getElementById('unique-opens').textContent = report.unique_opens;
                document.getElementById('unique-clicks').textContent = report.unique_clicks;
                document.getElementById('open-rate').textContent = report.open_rate;

                document.getElementById('report-details').style.display = 'grid';

                const ctx = document.getElementById('report-chart').getContext('2d');
                if (reportChart) {
                    reportChart.destroy();
                }
                reportChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Enviados', 'Aberturas', 'Cliques'],
                        datasets: [{
                            label: 'Estatísticas da Campanha',
                            data: [report.total_sent, report.unique_opens, report.unique_clicks],
                            backgroundColor: [
                                'rgba(52, 152, 219, 0.5)',
                                'rgba(46, 204, 113, 0.5)',
                                'rgba(241, 196, 15, 0.5)'
                            ],
                            borderColor: [
                                'rgba(52, 152, 219, 1)',
                                'rgba(46, 204, 113, 1)',
                                'rgba(241, 196, 15, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            window.onload = loadCampaigns;
        </script>
    </body>
    </html>
